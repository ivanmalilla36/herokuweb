var mongoose = require('mongoose');
var dbs = function(mon){
    mongoose.Promise = global.Promise;
    var db = mongoose.createConnection(mon.host,mon.database);
    db.on("open", function () { 
        console.log(`—— mongo ${mon.host} : ${mon.database} 连接成功！——`); 
    });

    db.on("error", function (error){
        console.error("-- mongo 连接失败");
        console.error(error) 
    });

    db.on('connecting', function () {
        console.log('mongodb connecting...');
    });
    
    db.on('connected', function () {
        console.log('mongodb connected...');
    });
    
    db.on('disconnecting', function () {
        console.log('mongodb disconnecting...');
    });
    
    db.on('disconnected', function () {
        console.log('mongodb disconnected...');
    });
    
    db.on("close", function () { 
        console.log("—— mongodb  已断开链接！——"); 
    });
    return {
        mongoose:mongoose,
        db:db
    };
}

module.exports = dbs;


//关闭数据库连接
//db.close();
